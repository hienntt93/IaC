import fabric, sys,csv
def main():
    file = input('Input path to ip list file: ')
    command = input('Which command you should want to run: ')
    # file = 'newfile.csv'
    # command = "sudo --version"
    results = {}
    mass_excution(results, read_file(file),command)
    for i in results.keys():
        print(f'{i}|{results[i]}')
        # print({i}, results.keys)

def mass_excution(result, ip_list, command):
    # user = input(' What is your username?: ')
    # keypath = input('Type the path to your sshkey ')
    user = 'ntthien'
    keypath = '/Users/133742/.ssh/id_rsa'
    for ip in ip_list:
        try:
            ip_strip = ip.strip()
            # print(ip_strip)
            result[ip_strip] = ssh_execution(user,keypath,ip_strip,command)
            # print(result[ip_strip()])
        except:
            # print(f'There is the error with {ip}')
            
            # print('There error')
            result[ip] = 'Error'

def ssh_execution(user,keyfile, ip, command):
    output = fabric.Connection(ip,user=user,connect_kwargs={'key_filename':keyfile}).run(command)
    # print(output)
    return output

def read_file(file):
    with open(file,'r') as f:
        ips = f.readlines()
    return ips

main()